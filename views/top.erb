<!DOCTYPE HTML>
<html style="margin: 0; padding: 0;">
<body style="margin: 0; padding: 0;">
<div id="player"></div>
<script>
  var playerHeight = window.innerHeight - 30;
  var playerWidth  = window.innerWidth;
  var playerDivStyle = document.getElementById('player').style;
  playerDivStyle.height = playerHeight + 'px';
  playerDivStyle.width  = playerWidth  + 'px';

  //Load player api asynchronously.
  var tag = document.createElement('script');
  tag.src = 'http://www.youtube.com/player_api';
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  var player;
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('player', {
      height: playerHeight,
      width: playerWidth,
      videoId: '<%= @video_id %>',
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      },
      playerVars: {
        'rel': 0
      }
    });
  }
  function onPlayerReady(evt) {
    evt.target.playVideo();
  }
  function onPlayerStateChange(evt) {
    if (evt.data != YT.PlayerState.ENDED) return;

    var url = location.href;
    if (url.length < document.URL.length) url = document.URL;

    var qIndex = url.indexOf('?');
    var urlBase;
    if (qIndex < 0) {
      urlBase = url;
    } else {
      urlBase = url.substring(0, qIndex);
    }

    location.href = urlBase + '?vid=<%= @video_id %>';
  }
</script>
</body>
</html>
